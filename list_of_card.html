<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–∞</title>

<style>
:root {
  --blue: #2430b8;
  --green: #1db46a;
  --bg: #f3f5fb;
  --text: #111;
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

/* ===== HEADER ===== */
.header {
  background: linear-gradient(180deg, #2b38d6, var(--blue));
  color: #fff;
  padding: 40px 16px 120px;
  text-align: center;
  position: sticky;
  top: 0;
}

.timer {
  margin-top: 16px;
  background: #fff;
  color: #111;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 13px;
  display: inline-block;
}

/* ===== CONTENT ===== */
.content {
  margin-top: -80px;
  padding: 24px 16px 40px;
  background: #fff;
  border-radius: 24px 24px 0 0;
}

.card-list {
  max-width: 420px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 14px;
}

/* ===== CARD ===== */
.gift {
  background: #fafbff;
  border-radius: 18px;
  padding: 14px;
  cursor: pointer;
  position: relative;

  border: 1px solid #e5e7eb;
  box-shadow: 0 2px 6px rgba(0,0,0,0.03);

  transition: background 0.25s, box-shadow 0.25s, transform 0.25s;
}

@media (hover:hover) {
  .gift:hover {
    background: #f5f7fd;
    box-shadow: 0 12px 30px rgba(0,0,0,.12);
    transform: translateY(-2px);
  }
}

.gift.is-open {
  background: #f0f2f5;
  box-shadow: inset 0 2px 6px rgba(0,0,0,.04), 0 8px 24px rgba(0,0,0,.06);
  transform: scale(0.98);
}

/* ===== HIT ===== */
.gift.is-hit {
  border: 2px solid var(--green);
  background: #fff;
  padding-top: 18px;
}

.hit {
  position: absolute;
  top: -10px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--green);
  color: #fff;
  font-size: 11px;
  padding: 2px 10px;
  border-radius: 999px;
  font-weight: 600;
}

/* ===== SUMMARY ===== */
.gift-summary {
  display: flex;
  align-items: center;
  gap: 14px;
}

.logo {
  width: 92px;
  height: 56px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: #fff;
}

.logo.green { background:#0b2f2f }
.logo.blue { background:#0d2d9a }
.logo.orange { background:#111 }
.logo.yellow { background:#ffe031;color:#111 }

.gift-title {
  font-size: 14px;
  font-weight: 600;
}

.gift-icon {
  margin-left: auto;
  font-size: 20px;
  color: #cbd5e1;
}

/* ===== DETAILS ===== */
.gift-details {
  height: 0;
  overflow: hidden;
  opacity: 0;
  transition: height 0.35s ease, opacity 0.25s ease;
}

.gift-details.open {
  opacity: 1;
}

/* ===== SKELETON ===== */
.skeleton {
  height: 14px;
  background: linear-gradient(90deg,#eee,#f5f5f5,#eee);
  background-size: 400% 100%;
  animation: skeleton 1.2s infinite;
  border-radius: 6px;
  margin-bottom: 10px;
}

@keyframes skeleton {
  0%{background-position:100%}
  100%{background-position:-100%}
}

/* ===== BUTTON ===== */
.primary-btn {
  width: 100%;
  height: 48px;
  border-radius: 14px;
  background: var(--blue);
  color: #fff;
  border: none;
  font-weight: 600;
}
</style>
</head>

<body>

<header class="header">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫</h1>
  <div class="timer" id="timer">‚è± –û—Å—Ç–∞–ª–æ—Å—å 05:00</div>
</header>

<section class="content">
  <div class="card-list" id="cardList"></div>
</section>

<script>
const API_BASE = window.location.origin;
let topPromotionIds = [];

/* ===== TIMER ===== */
let time = 300000;
setInterval(()=>{
  const m = String(Math.floor(time/60000)).padStart(2,'0');
  const s = String(Math.floor(time%60000/1000)).padStart(2,'0');
  document.getElementById('timer').textContent = `‚è± –û—Å—Ç–∞–ª–æ—Å—å ${m}:${s}`;
  time-=1000;
},1000);

/* ===== LOAD ===== */
async function loadPromotions() {
  const [p,t] = await Promise.all([
    fetch(`${API_BASE}/api/promotions`).then(r=>r.json()),
    fetch(`${API_BASE}/api/top-promotions`).then(r=>r.json())
  ]);
  topPromotionIds = t.map(x=>x.id);
  renderPromotions(p.promotions);
}

function renderPromotions(promos){
  cardList.innerHTML = promos.map(p=>{
    const hit = topPromotionIds.includes(p.id);
    const cls = ['green','blue','orange','yellow'][p.id%4];
    return `
    <div class="gift ${hit?'is-hit':''}" onclick="togglePromotionDetails(${p.id})">
      ${hit?'<span class="hit">–•–ò–¢</span>':''}
      <div class="gift-summary">
        <div class="logo ${cls}">${p.title.slice(0,4)}</div>
        <div class="gift-title">${p.title}</div>
        <div class="gift-icon">üéÅ</div>
      </div>
      <div class="gift-details" id="details-${p.id}"></div>
    </div>`;
  }).join('');
}

/* ===== TOGGLE ===== */
async function togglePromotionDetails(id){
  const d = document.getElementById(`details-${id}`);
  const c = d.closest('.gift');

  if(d.classList.contains('open')){
    d.style.height='0px';
    d.classList.remove('open');
    c.classList.remove('is-open');
    return;
  }

  document.querySelectorAll('.gift-details.open').forEach(x=>{
    x.style.height='0px';
    x.classList.remove('open');
    x.closest('.gift').classList.remove('is-open');
  });

  c.classList.add('is-open');

  if(d.dataset.loaded){
    open(d,c); return;
  }

  d.innerHTML=`
    <div style="padding-top:14px">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton" style="width:60%"></div>
    </div>`;
  d.classList.add('open');

  const promo = await fetch(`${API_BASE}/api/promotions/${id}`).then(r=>r.json());
  d.innerHTML=`
    <div style="padding-top:14px">
      <p style="font-size:14px;line-height:1.5">${promo.description}</p>
      <button class="primary-btn" onclick="window.open('${promo.link}','_blank')">
        –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫
      </button>
    </div>`;
  d.dataset.loaded='1';
  open(d,c);
}

function open(d,c){
  requestAnimationFrame(()=>{
    d.style.height=d.scrollHeight+'px';
    d.classList.add('open');
    setTimeout(()=>c.scrollIntoView({behavior:'smooth',block:'nearest'}),350);
  });
}

loadPromotions();
</script>
</body>
</html>
