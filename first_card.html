<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–†—É–ª–µ—Ç–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤</title>

<style>
:root {
  --bg: #000;
  --card-bg: #fff;
  --muted: #777;
  --blue: #3b5cff;
  --green: #1db46a;
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
  overflow: hidden;
}

/* ===== –ö–∞—Ä—Ç–æ—á–∫–∞ ===== */
.card {
  width: 100%;
  max-width: 360px;
  background: var(--card-bg);
  border-radius: 22px;
  padding: 22px;
  text-align: center;
  position: relative;
  z-index: 2;
}

/* ===== –¢–µ–∫—Å—Ç ===== */
.title {
  font-size: 20px;
  font-weight: 700;
}

.subtitle {
  font-size: 14px;
  color: var(--muted);
  margin: 6px 0 18px;
}

/* ===== –†—É–ª–µ—Ç–∫–∞ ===== */
.roulette-wrapper {
  background: #f2f3f5;
  border-radius: 18px;
  padding: 20px 0;
  margin-bottom: 18px;
  height: 140px;
  overflow: hidden;
  position: relative;
}

.roulette-list {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  transform: translateY(-50%);
}

.roulette-item {
  font-size: 48px;
  font-weight: 700;
  color: var(--blue);
  height: 56px;
  line-height: 56px;
  text-align: center;
  transition: filter 0.2s, opacity 0.2s, transform 0.2s;
}

.roulette-item.blur {
  filter: blur(3px);
  opacity: 0.35;
  transform: scale(0.85);
}

/* ===== –ö–Ω–æ–ø–∫–∞ ===== */
.button {
  position: relative;
  height: 54px;
  border-radius: 16px;
  overflow: hidden;
  background: #e6e6e6;
}

.button-fill {
  position: absolute;
  inset: 0;
  width: 0%;
  background: linear-gradient(90deg, #4d6bff, #7a8cff);
}

.button-text {
  position: relative;
  z-index: 2;
  color: #fff;
  font-weight: 600;
  font-size: 14px;
  line-height: 54px;
  text-align: center;
  user-select: none;
}

.button.active {
  background: var(--green);
  cursor: pointer;
}

.button.active .button-fill {
  width: 100%;
  background: var(--green);
}

/* ===== –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ ===== */
.confetti {
  position: fixed;
  top: -10px;
  width: 8px;
  height: 12px;
  animation: fall linear forwards;
  z-index: 1;
}

@keyframes fall {
  to {
    transform: translateY(110vh) rotate(360deg);
  }
}
</style>
</head>

<body>

<div class="card">
  <div id="title" class="title">–ï—â–µ —á—É—Ç—å-—á—É—Ç—å!</div>
  <div id="subtitle" class="subtitle">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞—Ä–∫–æ–≤!</div>

  <div class="roulette-wrapper">
    <div id="rouletteList" class="roulette-list"></div>
  </div>

  <div id="btn" class="button">
    <div id="btnFill" class="button-fill"></div>
    <div id="btnText" class="button-text">
      –î–æ –ø–æ–¥–∞—Ä–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å –µ—â–µ —á—É—Ç—å-—á—É—Ç—å!
    </div>
  </div>
</div>

<script>
// Initialize Telegram WebApp
if (window.Telegram && window.Telegram.WebApp) {
  window.Telegram.WebApp.ready();
  window.Telegram.WebApp.expand();
}

const rouletteList = document.getElementById('rouletteList');
const btn = document.getElementById('btn');
const btnFill = document.getElementById('btnFill');
const btnText = document.getElementById('btnText');
const title = document.getElementById('title');
const subtitle = document.getElementById('subtitle');

const DURATION = 5*1000; // 5 minutes
const FINAL_NUMBER = 102;
const start = Date.now();
const TIMEOUT_DURATION = 5 * 60 * 1000; // 5 minutes

let confettiInterval;
let timeoutReached = false;

/* ===== –†—É–ª–µ—Ç–∫–∞ ===== */
function renderRoulette(center) {
  rouletteList.innerHTML = '';

  const used = new Set([center]);

  function rand() {
    let n;
    do {
      n = Math.floor(Math.random() * 500) + 1;
    } while (used.has(n));
    used.add(n);
    return n;
  }

  const numbers = [
    rand(),
    rand(),
    center,
    rand(),
    rand()
  ];

  numbers.forEach((num, i) => {
    const el = document.createElement('div');
    el.className = 'roulette-item' + (i !== 2 ? ' blur' : '');
    el.textContent = num;
    rouletteList.appendChild(el);
  });
}

const rouletteInterval = setInterval(() => {
  renderRoulette(Math.floor(Math.random() * 500) + 1);
}, 80);

/* ===== –ü—Ä–æ–≥—Ä–µ—Å—Å ===== */
const progressInterval = setInterval(() => {
  const elapsed = Date.now() - start;
  const percent = Math.min((elapsed / DURATION) * 100, 100);
  btnFill.style.width = percent + '%';

  if (elapsed >= DURATION && !timeoutReached) {
    clearInterval(progressInterval);
    clearInterval(rouletteInterval);
    finish();
  }
  
  // Check for timeout (5 minutes without clicking)
  if (elapsed >= TIMEOUT_DURATION && !timeoutReached) {
    timeoutReached = true;
    clearInterval(progressInterval);
    clearInterval(rouletteInterval);
    showTimeout();
  }
}, 16);

function finish() {
  if (timeoutReached) return;
  
  renderRoulette(FINAL_NUMBER);

  title.textContent = '–£—Ä–∞! üéÅ';
  subtitle.innerHTML = '–£ –≤–∞—Å –µ—Å—Ç—å <b>5 –º–∏–Ω—É—Ç</b> –Ω–∞ –≤—ã–±–æ—Ä';

  btn.classList.add('active');
  btnText.textContent = '–í—ã–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫';

  startInfiniteConfetti();

  btn.addEventListener('click', () => {
    // Navigate to list page
    window.location.href = 'list_of_card.html';
  });
}

function showTimeout() {
  renderRoulette(FINAL_NUMBER);
  
  title.textContent = '–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ ‚è∞';
  subtitle.innerHTML = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫';
  
  btn.classList.remove('active');
  btnText.textContent = '–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ';
  
  btn.addEventListener('click', () => {
    if (window.Telegram && window.Telegram.WebApp) {
      // Close and ask user to reopen
      window.Telegram.WebApp.showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ');
      setTimeout(() => {
        window.Telegram.WebApp.close();
      }, 2000);
    }
  });
}

/* ===== –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ ===== */
function startInfiniteConfetti() {
  confettiInterval = setInterval(() => {
    for (let i = 0; i < 12; i++) {
      const el = document.createElement('div');
      el.className = 'confetti';
      el.style.left = Math.random() * 100 + 'vw';
      el.style.background = `hsl(${Math.random() * 360}, 80%, 60%)`;
      el.style.animationDuration = 3 + Math.random() * 3 + 's';
      el.style.opacity = Math.random();
      document.body.appendChild(el);

      setTimeout(() => el.remove(), 6000);
    }
  }, 400);
}
</script>

</body>
</html>
